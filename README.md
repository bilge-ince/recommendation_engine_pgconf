# Catalog Search
Catalog Using Postgresql &amp; PGvector

The objective of this experiment is to leverage the CLIP model in conjunction with PostgreSQL, employing the pgvector extension and PL/Python to execute transformation functions directly within the database for efficient searching. This setup involves a dataset of 44k Images of catalog. 

Instead of storing the images directly in the database, we store only their full file paths. The actual data stored in the database consists of image embeddings, which are generated by the CLIP model and encapsulated in 512-dimensional vectors as required by the model. This approach enables rapid search capabilities on a standard laptop.

We are showing also text to image search, searching on catalog passing text as input. 

## Sample Dataset
Load the dataset located inside the dataset folder using the following command command 
Create the table products and products_emb inside ddl folder
Load the table products using copy command

postgres=# copy products from 'stylesc.csv' header csv; 
The table should contains 44,440 rows.


## Install all dependencies for transformers and validate that CLIP model is available

Postgresql 16 installed.

EDB Language pack installed.

Run pip install from EDB Python directory as: /Library/edb/languagepack/v4/Python-3.11/bin/pip install -r requirements.txt

Install pgvector 0.6 extension from https://github.com/pgvector/pgvector

Validate that pl-python3u is working well 

run select public.test_plpython() inside the database;

postgres=# select public.test_plpython();
     test_plpython     
 PL/Python is working!
(1 row)

Python Environment: The Python environment accessible to PostgreSQL should have the necessary libraries installed: 
After test that this program is working: 

%python test_clip.py

## Create products_emb, install Pl_python3u functions

Open psql and create the table 

Drop table products_emb;

CREATE TABLE products_emb (
    Id integer,
    gender VARCHAR(50),
    masterCategory VARCHAR(100),
    subCategory VARCHAR(100),
    articleType VARCHAR(100),
    baseColour VARCHAR(50),
    Season text,
    year INTEGER,
    usage text null,
    productDisplayName TEXT null,
    Image_path text null, 
    embedding vector(512)
);



Install the functions inside DDL folder:

1 - load_fashion_tag -- this function will read the products table and insert inside the new products_emb and add 2 columns embedding and image_path



## Generate Embedding 

from psql 
run the following with the path as final path where you unzip all images

postgres=# select load_fashion_tag('/Users/francksidi/Downloads/archive/images','product', 32);




## Similarity Search using Streamlit application enabling WebCAM and Text Search on Images. 

Change the connection info inside. Run from the command line. Copy the logo.png image in the directory in which the python program is running.
For instance look for images from a text description: old man, old lady, blond lady ,...

%streamlit run streamlit_face_reco_text.py
